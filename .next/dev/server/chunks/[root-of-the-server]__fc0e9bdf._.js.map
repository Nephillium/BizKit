{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nlet connectionString = process.env.DATABASE_URL || '';\nif (connectionString.startsWith(\"psql \")) {\n  connectionString = connectionString.replace(\"psql \", \"\").replace(/^'|'$/g, \"\");\n}\n\nconst pool = new Pool({\n  connectionString,\n  ssl: { rejectUnauthorized: false },\n});\n\nexport async function query<T = any>(text: string, params?: any[]): Promise<T[]> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rows;\n  } finally {\n    client.release();\n  }\n}\n\nexport async function queryOne<T = any>(text: string, params?: any[]): Promise<T | null> {\n  const rows = await query<T>(text, params);\n  return rows[0] || null;\n}\n\nexport async function execute(text: string, params?: any[]): Promise<number> {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(text, params);\n    return result.rowCount || 0;\n  } finally {\n    client.release();\n  }\n}\n\nexport { pool };\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;AAEA,IAAI,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AACnD,IAAI,iBAAiB,UAAU,CAAC,UAAU;IACxC,mBAAmB,iBAAiB,OAAO,CAAC,SAAS,IAAI,OAAO,CAAC,UAAU;AAC7E;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB;IACA,KAAK;QAAE,oBAAoB;IAAM;AACnC;AAEO,eAAe,MAAe,IAAY,EAAE,MAAc;IAC/D,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,IAAI;IACpB,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe,SAAkB,IAAY,EAAE,MAAc;IAClE,MAAM,OAAO,MAAM,MAAS,MAAM;IAClC,OAAO,IAAI,CAAC,EAAE,IAAI;AACpB;AAEO,eAAe,QAAQ,IAAY,EAAE,MAAc;IACxD,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO,OAAO,QAAQ,IAAI;IAC5B,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/pages/api/init-db.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport { pool } from '../../lib/db';\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  const client = await pool.connect();\n  try {\n    await client.query('CREATE EXTENSION IF NOT EXISTS pgcrypto');\n    \n    await client.query(`\n      CREATE TABLE IF NOT EXISTS users (\n        id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),\n        email VARCHAR UNIQUE NOT NULL,\n        password_hash TEXT NOT NULL,\n        role TEXT DEFAULT 'user',\n        credits INTEGER DEFAULT 0,\n        usage_count INTEGER DEFAULT 0,\n        created_at TIMESTAMPTZ DEFAULT NOW()\n      )\n    `);\n    \n    await client.query(`\n      CREATE TABLE IF NOT EXISTS credit_transactions (\n        id SERIAL PRIMARY KEY,\n        user_id VARCHAR NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n        amount INTEGER NOT NULL,\n        reason TEXT NOT NULL,\n        created_at TIMESTAMPTZ DEFAULT NOW()\n      )\n    `);\n    \n    await client.query('CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)');\n    await client.query('CREATE INDEX IF NOT EXISTS idx_credit_transactions_user_id ON credit_transactions(user_id)');\n    \n    return res.status(200).json({ ok: true, message: 'Database initialized successfully' });\n  } catch (error: any) {\n    console.error('Database init error:', error);\n    return res.status(500).json({ ok: false, error: error.message });\n  } finally {\n    client.release();\n  }\n}\n"],"names":[],"mappings":";;;;AACA;;;;;;AAEe,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,SAAS,MAAM,0GAAI,CAAC,OAAO;IACjC,IAAI;QACF,MAAM,OAAO,KAAK,CAAC;QAEnB,MAAM,OAAO,KAAK,CAAC,CAAC;;;;;;;;;;IAUpB,CAAC;QAED,MAAM,OAAO,KAAK,CAAC,CAAC;;;;;;;;IAQpB,CAAC;QAED,MAAM,OAAO,KAAK,CAAC;QACnB,MAAM,OAAO,KAAK,CAAC;QAEnB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM,SAAS;QAAoC;IACvF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAO,OAAO,MAAM,OAAO;QAAC;IAChE,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}}]
}