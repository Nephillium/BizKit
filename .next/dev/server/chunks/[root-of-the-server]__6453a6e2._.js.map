{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/pages/api/generate.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\nimport OpenAI from 'openai'\n\n// This is using Replit's AI Integrations service, which provides OpenAI-compatible API access\n// without requiring your own OpenAI API key. Charges are billed to your Replit credits.\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst MODEL = 'gpt-4o-mini' // Using gpt-4o-mini as specified in user requirements\n\ntype Tool = 'cold_email' | 'proposal' | 'contract' | 'social_pack'\n\ninterface ColdEmailInputs {\n  target: string\n  service: string\n  tone: string\n  language: string\n}\n\ninterface ProposalInputs {\n  clientType: string\n  projectScope: string\n  deliverables: string\n  budgetRange: string\n  language: string\n}\n\ninterface ContractInputs {\n  clientName: string\n  providerName: string\n  serviceDescription: string\n  paymentTerms: string\n  jurisdiction: string\n  language: string\n}\n\ninterface SocialPackInputs {\n  businessType: string\n  niche: string\n  tone: string\n  platform: string\n  language: string\n}\n\ntype Inputs = ColdEmailInputs | ProposalInputs | ContractInputs | SocialPackInputs\n\ninterface RequestBody {\n  tool: Tool\n  inputs: Inputs\n}\n\ninterface ApiResponse {\n  ok: boolean\n  output?: string\n  error?: string\n}\n\nfunction buildPrompts(tool: Tool, inputs: Inputs): { systemPrompt: string; userPrompt: string } {\n  switch (tool) {\n    case 'cold_email': {\n      const { target, service, tone, language } = inputs as ColdEmailInputs\n      return {\n        systemPrompt: 'You are an expert B2B sales copywriter.',\n        userPrompt: `Write 3 short cold email variants for the following:\n\nTarget audience: ${target || 'business owners'}\nService being offered: ${service || 'consulting services'}\nTone: ${tone || 'professional'}\nLanguage: ${language || 'English'}\n\nEach email should include:\n- A compelling subject line\n- A concise body (3-5 sentences max)\n\nReturn as a numbered list (1, 2, 3) with clear separation between each variant.`,\n      }\n    }\n\n    case 'proposal': {\n      const { clientType, projectScope, deliverables, budgetRange, language } = inputs as ProposalInputs\n      return {\n        systemPrompt: 'You are a professional consultant writing project proposals.',\n        userPrompt: `Write a professional project proposal with the following details:\n\nClient Type: ${clientType || 'business client'}\nProject Scope: ${projectScope || 'to be defined'}\nDeliverables: ${deliverables || 'to be defined'}\nBudget Range: ${budgetRange || 'to be discussed'}\nLanguage: ${language || 'English'}\n\nStructure the proposal with these sections:\n1. Introduction\n2. Understanding of Needs\n3. Scope of Work\n4. Deliverables\n5. Timeline\n6. Investment\n7. Next Steps\n\nMake it professional, clear, and persuasive.`,\n      }\n    }\n\n    case 'contract': {\n      const { clientName, providerName, serviceDescription, paymentTerms, jurisdiction, language } = inputs as ContractInputs\n      return {\n        systemPrompt: 'You draft simple, plain-language service agreements (not legal advice).',\n        userPrompt: `Draft a simple service agreement with the following details:\n\nClient Name: ${clientName || '[CLIENT NAME]'}\nProvider Name: ${providerName || '[PROVIDER NAME]'}\nService Description: ${serviceDescription || 'to be defined'}\nPayment Terms: ${paymentTerms || 'to be agreed'}\nJurisdiction: ${jurisdiction || 'to be specified'}\nLanguage: ${language || 'English'}\n\nInclude these clauses:\n1. Parties\n2. Services\n3. Term\n4. Fees and Payment\n5. Confidentiality\n6. Intellectual Property\n7. Termination\n8. Governing Law\n\nKeep it concise and in plain language. Add a disclaimer that this is not legal advice.`,\n      }\n    }\n\n    case 'social_pack': {\n      const { businessType, niche, tone, platform, language } = inputs as SocialPackInputs\n      return {\n        systemPrompt: 'You are a social media strategist.',\n        userPrompt: `Create 10 short social media post ideas for the following:\n\nBusiness Type: ${businessType || 'business'}\nNiche: ${niche || 'general'}\nTone: ${tone || 'friendly'}\nPlatform: ${platform || 'social media'}\nLanguage: ${language || 'English'}\n\nProvide 10 numbered post ideas (1-10) with captions ready to use.\nEach post should be engaging and appropriate for the specified platform.`,\n      }\n    }\n\n    default:\n      throw new Error(`Unknown tool: ${tool}`)\n  }\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ ok: false, error: 'method_not_allowed' })\n  }\n\n  const baseURL = process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n  const apiKey = process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n\n  if (!baseURL || !apiKey) {\n    return res.status(500).json({ ok: false, error: 'missing_openai_key' })\n  }\n\n  try {\n    const { tool, inputs } = req.body as RequestBody\n\n    if (!tool || !inputs) {\n      return res.status(400).json({ ok: false, error: 'invalid_request' })\n    }\n\n    const { systemPrompt, userPrompt } = buildPrompts(tool, inputs)\n\n    const openai = new OpenAI({\n      baseURL,\n      apiKey,\n    })\n\n    const response = await openai.chat.completions.create({\n      model: MODEL,\n      messages: [\n        { role: 'system', content: systemPrompt },\n        { role: 'user', content: userPrompt },\n      ],\n      max_tokens: 1000,\n      temperature: 0.7,\n    })\n\n    const content = response.choices[0]?.message?.content || ''\n\n    return res.status(200).json({ ok: true, output: content })\n  } catch (error: any) {\n    console.error('OpenAI API Error:', error)\n\n    const errorMessage = error?.message || String(error)\n    const errorCode = error?.code || ''\n\n    if (\n      errorMessage.includes('429') ||\n      errorMessage.includes('insufficient_quota') ||\n      errorCode === 'insufficient_quota'\n    ) {\n      return res.status(200).json({\n        ok: true,\n        output: 'AI quota is exhausted on the server. Please add credits to the OpenAI account.',\n      })\n    }\n\n    return res.status(500).json({ ok: false, error: 'openai_error' })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}