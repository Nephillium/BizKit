{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/pages/api/generate.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\nimport OpenAI from 'openai'\n\ntype ModelOption = 'gpt-4o-mini' | 'gpt-4o'\ntype LengthOption = 'short' | 'standard' | 'detailed'\ntype Tool = 'cold_email' | 'proposal' | 'contract' | 'social_pack'\n\nconst MAX_TOKENS_MAP: Record<LengthOption, number> = {\n  short: 500,\n  standard: 1000,\n  detailed: 2000,\n}\n\ninterface ColdEmailInputs {\n  target: string\n  service: string\n  tone: string\n  language: string\n}\n\ninterface ProposalInputs {\n  clientType: string\n  projectScope: string\n  deliverables: string\n  budgetRange: string\n  language: string\n}\n\ninterface ContractInputs {\n  clientName: string\n  providerName: string\n  serviceDescription: string\n  paymentTerms: string\n  jurisdiction: string\n  language: string\n}\n\ninterface SocialPackInputs {\n  businessType: string\n  niche: string\n  tone: string\n  platform: string\n  language: string\n}\n\ntype Inputs = ColdEmailInputs | ProposalInputs | ContractInputs | SocialPackInputs\n\ninterface PremiumOptions {\n  model?: ModelOption\n  length?: LengthOption\n  creativity?: number // 0-100 maps to temperature 0-1\n  customInstructions?: string\n}\n\ninterface RequestBody {\n  tool: Tool\n  inputs: Inputs\n  premiumOptions?: PremiumOptions\n}\n\ninterface ApiResponse {\n  ok: boolean\n  output?: string\n  error?: string\n}\n\nfunction buildPrompts(tool: Tool, inputs: Inputs): { systemPrompt: string; userPrompt: string } {\n  switch (tool) {\n    case 'cold_email': {\n      const { target, service, tone, language } = inputs as ColdEmailInputs\n      return {\n        systemPrompt: 'You are an expert B2B sales copywriter.',\n        userPrompt: `Write 3 short cold email variants for the following:\n\nTarget audience: ${target || 'business owners'}\nService being offered: ${service || 'consulting services'}\nTone: ${tone || 'professional'}\nLanguage: ${language || 'English'}\n\nEach email should include:\n- A compelling subject line\n- A concise body (3-5 sentences max)\n\nReturn as a numbered list (1, 2, 3) with clear separation between each variant.`,\n      }\n    }\n\n    case 'proposal': {\n      const { clientType, projectScope, deliverables, budgetRange, language } = inputs as ProposalInputs\n      return {\n        systemPrompt: 'You are a professional consultant writing project proposals.',\n        userPrompt: `Write a professional project proposal with the following details:\n\nClient Type: ${clientType || 'business client'}\nProject Scope: ${projectScope || 'to be defined'}\nDeliverables: ${deliverables || 'to be defined'}\nBudget Range: ${budgetRange || 'to be discussed'}\nLanguage: ${language || 'English'}\n\nStructure the proposal with these sections:\n1. Introduction\n2. Understanding of Needs\n3. Scope of Work\n4. Deliverables\n5. Timeline\n6. Investment\n7. Next Steps\n\nMake it professional, clear, and persuasive.`,\n      }\n    }\n\n    case 'contract': {\n      const { clientName, providerName, serviceDescription, paymentTerms, jurisdiction, language } = inputs as ContractInputs\n      return {\n        systemPrompt: 'You draft simple, plain-language service agreements (not legal advice).',\n        userPrompt: `Draft a simple service agreement with the following details:\n\nClient Name: ${clientName || '[CLIENT NAME]'}\nProvider Name: ${providerName || '[PROVIDER NAME]'}\nService Description: ${serviceDescription || 'to be defined'}\nPayment Terms: ${paymentTerms || 'to be agreed'}\nJurisdiction: ${jurisdiction || 'to be specified'}\nLanguage: ${language || 'English'}\n\nInclude these clauses:\n1. Parties\n2. Services\n3. Term\n4. Fees and Payment\n5. Confidentiality\n6. Intellectual Property\n7. Termination\n8. Governing Law\n\nKeep it concise and in plain language. Add a disclaimer that this is not legal advice.`,\n      }\n    }\n\n    case 'social_pack': {\n      const { businessType, niche, tone, platform, language } = inputs as SocialPackInputs\n      return {\n        systemPrompt: 'You are a social media strategist.',\n        userPrompt: `Create 10 short social media post ideas for the following:\n\nBusiness Type: ${businessType || 'business'}\nNiche: ${niche || 'general'}\nTone: ${tone || 'friendly'}\nPlatform: ${platform || 'social media'}\nLanguage: ${language || 'English'}\n\nProvide 10 numbered post ideas (1-10) with captions ready to use.\nEach post should be engaging and appropriate for the specified platform.`,\n      }\n    }\n\n    default:\n      throw new Error(`Unknown tool: ${tool}`)\n  }\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse<ApiResponse>\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ ok: false, error: 'method_not_allowed' })\n  }\n\n  // Support both Replit AI Integrations and standard OpenAI API key\n  const replitBaseURL = process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n  const replitApiKey = process.env.AI_INTEGRATIONS_OPENAI_API_KEY\n  const standardApiKey = process.env.OPENAI_API_KEY\n\n  // Use Replit AI Integrations if available, otherwise fall back to standard OpenAI\n  const useReplitIntegrations = replitBaseURL && replitApiKey\n  const apiKey = useReplitIntegrations ? replitApiKey : standardApiKey\n  const baseURL = useReplitIntegrations ? replitBaseURL : undefined\n\n  if (!apiKey) {\n    return res.status(500).json({ ok: false, error: 'missing_openai_key' })\n  }\n\n  try {\n    const { tool, inputs, premiumOptions } = req.body as RequestBody\n\n    if (!tool || !inputs) {\n      return res.status(400).json({ ok: false, error: 'invalid_request' })\n    }\n\n    // Premium options with defaults\n    const model: ModelOption = premiumOptions?.model || 'gpt-4o-mini'\n    const length: LengthOption = premiumOptions?.length || 'standard'\n    const creativity = premiumOptions?.creativity ?? 50 // 0-100 scale\n    const customInstructions = premiumOptions?.customInstructions || ''\n\n    // Convert creativity (0-100) to temperature (0-1)\n    const temperature = Math.min(Math.max(creativity / 100, 0), 1)\n    const maxTokens = MAX_TOKENS_MAP[length]\n\n    const { systemPrompt, userPrompt } = buildPrompts(tool, inputs)\n\n    // Add custom instructions to system prompt if provided\n    const finalSystemPrompt = customInstructions\n      ? `${systemPrompt}\\n\\nAdditional Instructions from User:\\n${customInstructions}`\n      : systemPrompt\n\n    const openai = new OpenAI({\n      ...(baseURL && { baseURL }),\n      apiKey,\n    })\n\n    const response = await openai.chat.completions.create({\n      model,\n      messages: [\n        { role: 'system', content: finalSystemPrompt },\n        { role: 'user', content: userPrompt },\n      ],\n      max_tokens: maxTokens,\n      temperature,\n    })\n\n    const content = response.choices[0]?.message?.content || ''\n\n    return res.status(200).json({ ok: true, output: content })\n  } catch (error: any) {\n    console.error('OpenAI API Error:', error)\n\n    const errorMessage = error?.message || String(error)\n    const errorCode = error?.code || ''\n\n    if (\n      errorMessage.includes('429') ||\n      errorMessage.includes('insufficient_quota') ||\n      errorCode === 'insufficient_quota'\n    ) {\n      return res.status(200).json({\n        ok: true,\n        output: 'AI quota is exhausted on the server. Please add credits to the OpenAI account.',\n      })\n    }\n\n    return res.status(500).json({ ok: false, error: 'openai_error' })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}