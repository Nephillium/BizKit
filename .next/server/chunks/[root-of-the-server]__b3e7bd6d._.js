module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},32085,e=>e.a(async(t,a)=>{try{let t=await e.y("openid-client");e.n(t),a()}catch(e){a(e)}},!0),78844,(e,t,a)=>{t.exports=e.x("memoizee",()=>require("memoizee"))},89722,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm");e.n(t),a()}catch(e){a(e)}},!0),62018,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/pg-core");e.n(t),a()}catch(e){a(e)}},!0),80221,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-zod");e.n(t),a()}catch(e){a(e)}},!0),65780,e=>e.a(async(t,a)=>{try{var r=e.i(89722),n=e.i(62018),i=e.i(80221),s=t([r,n,i]);[r,n,i]=s.then?(await s)():s;let o=(0,n.pgTable)("sessions",{sid:(0,n.varchar)("sid").primaryKey(),sess:(0,n.jsonb)("sess").notNull(),expire:(0,n.timestamp)("expire").notNull()},e=>[(0,n.index)("IDX_session_expire").on(e.expire)]),l=(0,n.pgTable)("users",{id:(0,n.varchar)("id").primaryKey().default(r.sql`gen_random_uuid()`),email:(0,n.varchar)("email").unique(),firstName:(0,n.varchar)("first_name"),lastName:(0,n.varchar)("last_name"),profileImageUrl:(0,n.varchar)("profile_image_url"),createdAt:(0,n.timestamp)("created_at").defaultNow(),updatedAt:(0,n.timestamp)("updated_at").defaultNow()}),c=(0,n.pgTable)("generations",{id:(0,n.serial)("id").primaryKey(),userId:(0,n.varchar)("user_id").notNull().references(()=>l.id),toolType:(0,n.varchar)("tool_type",{length:50}).notNull(),inputs:(0,n.jsonb)("inputs").notNull(),output:(0,n.text)("output").notNull(),createdAt:(0,n.timestamp)("created_at").defaultNow()}),u=(0,i.createInsertSchema)(c).omit({id:!0,createdAt:!0});e.s(["generations",0,c,"insertGenerationSchema",0,u,"sessions",0,o,"users",0,l]),a()}catch(e){a(e)}},!1),89501,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/node-postgres");e.n(t),a()}catch(e){a(e)}},!0),30056,e=>e.a(async(t,a)=>{try{let t=await e.y("pg");e.n(t),a()}catch(e){a(e)}},!0),93759,e=>e.a(async(t,a)=>{try{var r=e.i(89501),n=e.i(30056),i=e.i(65780),s=t([r,n,i]);[r,n,i]=s.then?(await s)():s;let{Pool:o}=n.default;if(!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set. Did you forget to provision a database?");let l=new o({connectionString:process.env.DATABASE_URL}),c=(0,r.drizzle)(l,{schema:i});e.s(["db",0,c]),a()}catch(e){a(e)}},!1),13456,e=>e.a(async(t,a)=>{try{var r=e.i(65780),n=e.i(93759),i=e.i(89722),s=t([r,n,i]);[r,n,i]=s.then?(await s)():s;let o=new class{async getUser(e){let[t]=await n.db.select().from(r.users).where((0,i.eq)(r.users.id,e));return t}async upsertUser(e){let[t]=await n.db.insert(r.users).values(e).onConflictDoUpdate({target:r.users.id,set:{...e,updatedAt:new Date}}).returning();return t}async createGeneration(e){let[t]=await n.db.insert(r.generations).values(e).returning();return t}async getGenerations(e){return await n.db.select().from(r.generations).where((0,i.eq)(r.generations.userId,e)).orderBy((0,i.desc)(r.generations.createdAt))}async getGeneration(e){let[t]=await n.db.select().from(r.generations).where((0,i.eq)(r.generations.id,e));return t}async deleteGeneration(e){await n.db.delete(r.generations).where((0,i.eq)(r.generations.id,e))}};e.s(["storage",0,o]),a()}catch(e){a(e)}},!1),65266,e=>e.a(async(t,a)=>{try{var r=e.i(32085),n=e.i(78844),i=e.i(13456),s=t([r,i]);[r,i]=s.then?(await s)():s;let u=(0,n.default)(async()=>await r.discovery(new URL(process.env.ISSUER_URL??"https://replit.com/oidc"),process.env.REPL_ID),{maxAge:36e5});async function o(e){await i.storage.upsertUser({id:e.sub,email:e.email,firstName:e.first_name,lastName:e.last_name,profileImageUrl:e.profile_image_url})}function l(e){let t=e.headers.host||"localhost:5000";return`https://${t}/api/callback`}function c(e){let t=e.headers.host||"localhost:5000";return`https://${t}`}e.s(["getBaseUrl",()=>c,"getCallbackUrl",()=>l,"getOidcConfig",0,u,"upsertUser",()=>o]),a()}catch(e){a(e)}},!1),36890,(e,t,a)=>{t.exports=e.x("cookie",()=>require("cookie"))},5565,e=>e.a(async(t,a)=>{try{var r=e.i(36890),n=e.i(32085),i=e.i(65266),s=t([n,i]);async function o(e){if(!e||!e.expires_at)return!1;if(Math.floor(Date.now()/1e3)<=e.expires_at)return!0;if(!e.refresh_token)return!1;try{let t=await (0,i.getOidcConfig)();return await n.refreshTokenGrant(t,e.refresh_token),!0}catch{return!1}}function l(e){return async(t,a)=>{let n=function(e){let t=(0,r.parse)(e.headers.cookie||"").session;if(!t)return null;try{let e=Buffer.from(t,"base64").toString("utf-8");return JSON.parse(e)}catch{return null}}(t);return n&&await o(n)?e(t,a,n):a.status(401).json({message:"Unauthorized"})}}[n,i]=s.then?(await s)():s,e.s(["withAuth",()=>l]),a()}catch(e){a(e)}},!1),84487,e=>e.a(async(t,a)=>{try{var r=e.i(5565),n=e.i(13456),i=t([r,n]);async function s(e,t,a){let r=a.claims?.sub;if(!r)return t.status(401).json({message:"Unauthorized"});if("GET"===e.method)try{let e=await n.storage.getGenerations(r);t.json(e)}catch(e){console.error("Error fetching generations:",e),t.status(500).json({message:"Failed to fetch generations"})}else if("POST"===e.method)try{let{toolType:a,inputs:i,output:s}=e.body,o=await n.storage.createGeneration({userId:r,toolType:a,inputs:i,output:s});t.json(o)}catch(e){console.error("Error creating generation:",e),t.status(500).json({message:"Failed to save generation"})}else t.status(405).json({message:"Method not allowed"})}[r,n]=i.then?(await i)():i;let o=(0,r.withAuth)(s);e.s(["default",0,o]),a()}catch(e){a(e)}},!1),28308,e=>e.a(async(t,a)=>{try{var r=e.i(26747),n=e.i(90406),i=e.i(44898),s=e.i(62950),o=e.i(84487),l=e.i(7031),c=e.i(81927),u=e.i(46432),d=t([o]);[o]=d.then?(await d)():d;let h=(0,s.hoist)(o,"default"),g=(0,s.hoist)(o,"config"),m=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/generations/index",pathname:"/api/generations",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,a){m.isDev&&(0,u.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/generations/index";n=n.replace(/\/index$/,"")||"/";let i=await m.prepare(e,t,{srcPage:n});if(!i){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:s,params:o,prerenderManifest:d,routerServerContext:p}=i;try{let a=e.method||"GET",r=(0,l.getTracer)(),i=r.getActiveScopeSpan(),u=m.instrumentationOnRequestError.bind(m),h=async i=>m.render(e,t,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:m.isDev,page:"/api/generations/index",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>u(e,...t)}).finally(()=>{if(!i)return;i.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${a} ${s}`;i.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),i.updateName(e)}else i.updateName(`${a} ${n}`)});i?await h(i):await r.withPropagatedContext(e.headers,()=>r.trace(c.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:l.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},h))}catch(e){if(m.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,g,"default",0,h,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__b3e7bd6d._.js.map