module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},32085,e=>e.a(async(t,a)=>{try{let t=await e.y("openid-client");e.n(t),a()}catch(e){a(e)}},!0),78844,(e,t,a)=>{t.exports=e.x("memoizee",()=>require("memoizee"))},89722,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm");e.n(t),a()}catch(e){a(e)}},!0),62018,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/pg-core");e.n(t),a()}catch(e){a(e)}},!0),80221,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-zod");e.n(t),a()}catch(e){a(e)}},!0),65780,e=>e.a(async(t,a)=>{try{var r=e.i(89722),n=e.i(62018),s=e.i(80221),i=t([r,n,s]);[r,n,s]=i.then?(await i)():i;let o=(0,n.pgTable)("sessions",{sid:(0,n.varchar)("sid").primaryKey(),sess:(0,n.jsonb)("sess").notNull(),expire:(0,n.timestamp)("expire").notNull()},e=>[(0,n.index)("IDX_session_expire").on(e.expire)]),l=(0,n.pgTable)("users",{id:(0,n.varchar)("id").primaryKey().default(r.sql`gen_random_uuid()`),email:(0,n.varchar)("email").unique(),firstName:(0,n.varchar)("first_name"),lastName:(0,n.varchar)("last_name"),profileImageUrl:(0,n.varchar)("profile_image_url"),createdAt:(0,n.timestamp)("created_at").defaultNow(),updatedAt:(0,n.timestamp)("updated_at").defaultNow()}),u=(0,n.pgTable)("generations",{id:(0,n.serial)("id").primaryKey(),userId:(0,n.varchar)("user_id").notNull().references(()=>l.id),toolType:(0,n.varchar)("tool_type",{length:50}).notNull(),inputs:(0,n.jsonb)("inputs").notNull(),output:(0,n.text)("output").notNull(),createdAt:(0,n.timestamp)("created_at").defaultNow()}),c=(0,s.createInsertSchema)(u).omit({id:!0,createdAt:!0});e.s(["generations",0,u,"insertGenerationSchema",0,c,"sessions",0,o,"users",0,l]),a()}catch(e){a(e)}},!1),89501,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/node-postgres");e.n(t),a()}catch(e){a(e)}},!0),30056,e=>e.a(async(t,a)=>{try{let t=await e.y("pg");e.n(t),a()}catch(e){a(e)}},!0),93759,e=>e.a(async(t,a)=>{try{var r=e.i(89501),n=e.i(30056),s=e.i(65780),i=t([r,n,s]);[r,n,s]=i.then?(await i)():i;let{Pool:o}=n.default;if(!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set. Did you forget to provision a database?");let l=new o({connectionString:process.env.DATABASE_URL}),u=(0,r.drizzle)(l,{schema:s});e.s(["db",0,u]),a()}catch(e){a(e)}},!1),13456,e=>e.a(async(t,a)=>{try{var r=e.i(65780),n=e.i(93759),s=e.i(89722),i=t([r,n,s]);[r,n,s]=i.then?(await i)():i;let o=new class{async getUser(e){let[t]=await n.db.select().from(r.users).where((0,s.eq)(r.users.id,e));return t}async upsertUser(e){let[t]=await n.db.insert(r.users).values(e).onConflictDoUpdate({target:r.users.id,set:{...e,updatedAt:new Date}}).returning();return t}async createGeneration(e){let[t]=await n.db.insert(r.generations).values(e).returning();return t}async getGenerations(e){return await n.db.select().from(r.generations).where((0,s.eq)(r.generations.userId,e)).orderBy((0,s.desc)(r.generations.createdAt))}async getGeneration(e){let[t]=await n.db.select().from(r.generations).where((0,s.eq)(r.generations.id,e));return t}async deleteGeneration(e){await n.db.delete(r.generations).where((0,s.eq)(r.generations.id,e))}};e.s(["storage",0,o]),a()}catch(e){a(e)}},!1),65266,e=>e.a(async(t,a)=>{try{var r=e.i(32085),n=e.i(78844),s=e.i(13456),i=t([r,s]);[r,s]=i.then?(await i)():i;let c=(0,n.default)(async()=>await r.discovery(new URL(process.env.ISSUER_URL??"https://replit.com/oidc"),process.env.REPL_ID),{maxAge:36e5});async function o(e){await s.storage.upsertUser({id:e.sub,email:e.email,firstName:e.first_name,lastName:e.last_name,profileImageUrl:e.profile_image_url})}function l(e){let t=e.headers.host||"localhost:5000";return`https://${t}/api/callback`}function u(e){let t=e.headers.host||"localhost:5000";return`https://${t}`}e.s(["getBaseUrl",()=>u,"getCallbackUrl",()=>l,"getOidcConfig",0,c,"upsertUser",()=>o]),a()}catch(e){a(e)}},!1),36890,(e,t,a)=>{t.exports=e.x("cookie",()=>require("cookie"))},5565,e=>e.a(async(t,a)=>{try{var r=e.i(36890),n=e.i(32085),s=e.i(65266),i=t([n,s]);async function o(e){if(!e||!e.expires_at)return!1;if(Math.floor(Date.now()/1e3)<=e.expires_at)return!0;if(!e.refresh_token)return!1;try{let t=await (0,s.getOidcConfig)();return await n.refreshTokenGrant(t,e.refresh_token),!0}catch{return!1}}function l(e){return async(t,a)=>{let n=function(e){let t=(0,r.parse)(e.headers.cookie||"").session;if(!t)return null;try{let e=Buffer.from(t,"base64").toString("utf-8");return JSON.parse(e)}catch{return null}}(t);return n&&await o(n)?e(t,a,n):a.status(401).json({message:"Unauthorized"})}}[n,s]=i.then?(await i)():i,e.s(["withAuth",()=>l]),a()}catch(e){a(e)}},!1),72016,e=>e.a(async(t,a)=>{try{var r=e.i(5565),n=e.i(13456),s=t([r,n]);async function i(e,t,a){let r=a.claims?.sub;if(!r)return t.status(401).json({message:"Unauthorized"});let s=e.query.id;if("string"!=typeof s)return t.status(400).json({message:"Invalid ID"});let i=parseInt(s,10);if(isNaN(i))return t.status(400).json({message:"Invalid ID"});if("DELETE"===e.method)try{let e=await n.storage.getGeneration(i);if(!e)return t.status(404).json({message:"Generation not found"});if(e.userId!==r)return t.status(403).json({message:"Forbidden"});await n.storage.deleteGeneration(i),t.json({success:!0})}catch(e){console.error("Error deleting generation:",e),t.status(500).json({message:"Failed to delete generation"})}else t.status(405).json({message:"Method not allowed"})}[r,n]=s.then?(await s)():s;let o=(0,r.withAuth)(i);e.s(["default",0,o]),a()}catch(e){a(e)}},!1),7118,e=>e.a(async(t,a)=>{try{var r=e.i(26747),n=e.i(90406),s=e.i(44898),i=e.i(62950),o=e.i(72016),l=e.i(7031),u=e.i(81927),c=e.i(46432),d=t([o]);[o]=d.then?(await d)():d;let h=(0,i.hoist)(o,"default"),g=(0,i.hoist)(o,"config"),m=new s.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/generations/[id]",pathname:"/api/generations/[id]",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,a){m.isDev&&(0,c.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let n="/api/generations/[id]";n=n.replace(/\/index$/,"")||"/";let s=await m.prepare(e,t,{srcPage:n});if(!s){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:i,params:o,prerenderManifest:d,routerServerContext:p}=s;try{let a=e.method||"GET",r=(0,l.getTracer)(),s=r.getActiveScopeSpan(),c=m.instrumentationOnRequestError.bind(m),h=async s=>m.render(e,t,{query:{...i,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:m.isDev,page:"/api/generations/[id]",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>c(e,...t)}).finally(()=>{if(!s)return;s.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=e.get("next.route");if(i){let e=`${a} ${i}`;s.setAttributes({"next.route":i,"http.route":i,"next.span_name":e}),s.updateName(e)}else s.updateName(`${a} ${n}`)});s?await h(s):await r.withPropagatedContext(e.headers,()=>r.trace(u.BaseServerSpan.handleRequest,{spanName:`${a} ${n}`,kind:l.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},h))}catch(e){if(m.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,g,"default",0,h,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__0e79cd2e._.js.map