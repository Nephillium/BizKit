module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},32085,e=>e.a(async(t,a)=>{try{let t=await e.y("openid-client");e.n(t),a()}catch(e){a(e)}},!0),78844,(e,t,a)=>{t.exports=e.x("memoizee",()=>require("memoizee"))},89722,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm");e.n(t),a()}catch(e){a(e)}},!0),62018,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/pg-core");e.n(t),a()}catch(e){a(e)}},!0),80221,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-zod");e.n(t),a()}catch(e){a(e)}},!0),65780,e=>e.a(async(t,a)=>{try{var r=e.i(89722),i=e.i(62018),n=e.i(80221),s=t([r,i,n]);[r,i,n]=s.then?(await s)():s;let o=(0,i.pgTable)("sessions",{sid:(0,i.varchar)("sid").primaryKey(),sess:(0,i.jsonb)("sess").notNull(),expire:(0,i.timestamp)("expire").notNull()},e=>[(0,i.index)("IDX_session_expire").on(e.expire)]),l=(0,i.pgTable)("users",{id:(0,i.varchar)("id").primaryKey().default(r.sql`gen_random_uuid()`),email:(0,i.varchar)("email").unique(),firstName:(0,i.varchar)("first_name"),lastName:(0,i.varchar)("last_name"),profileImageUrl:(0,i.varchar)("profile_image_url"),createdAt:(0,i.timestamp)("created_at").defaultNow(),updatedAt:(0,i.timestamp)("updated_at").defaultNow()}),c=(0,i.pgTable)("generations",{id:(0,i.serial)("id").primaryKey(),userId:(0,i.varchar)("user_id").notNull().references(()=>l.id),toolType:(0,i.varchar)("tool_type",{length:50}).notNull(),inputs:(0,i.jsonb)("inputs").notNull(),output:(0,i.text)("output").notNull(),createdAt:(0,i.timestamp)("created_at").defaultNow()}),d=(0,n.createInsertSchema)(c).omit({id:!0,createdAt:!0});e.s(["generations",0,c,"insertGenerationSchema",0,d,"sessions",0,o,"users",0,l]),a()}catch(e){a(e)}},!1),89501,e=>e.a(async(t,a)=>{try{let t=await e.y("drizzle-orm/node-postgres");e.n(t),a()}catch(e){a(e)}},!0),30056,e=>e.a(async(t,a)=>{try{let t=await e.y("pg");e.n(t),a()}catch(e){a(e)}},!0),93759,e=>e.a(async(t,a)=>{try{var r=e.i(89501),i=e.i(30056),n=e.i(65780),s=t([r,i,n]);[r,i,n]=s.then?(await s)():s;let{Pool:o}=i.default;if(!process.env.DATABASE_URL)throw Error("DATABASE_URL must be set. Did you forget to provision a database?");let l=new o({connectionString:process.env.DATABASE_URL}),c=(0,r.drizzle)(l,{schema:n});e.s(["db",0,c]),a()}catch(e){a(e)}},!1),13456,e=>e.a(async(t,a)=>{try{var r=e.i(65780),i=e.i(93759),n=e.i(89722),s=t([r,i,n]);[r,i,n]=s.then?(await s)():s;let o=new class{async getUser(e){let[t]=await i.db.select().from(r.users).where((0,n.eq)(r.users.id,e));return t}async upsertUser(e){let[t]=await i.db.insert(r.users).values(e).onConflictDoUpdate({target:r.users.id,set:{...e,updatedAt:new Date}}).returning();return t}async createGeneration(e){let[t]=await i.db.insert(r.generations).values(e).returning();return t}async getGenerations(e){return await i.db.select().from(r.generations).where((0,n.eq)(r.generations.userId,e)).orderBy((0,n.desc)(r.generations.createdAt))}async getGeneration(e){let[t]=await i.db.select().from(r.generations).where((0,n.eq)(r.generations.id,e));return t}async deleteGeneration(e){await i.db.delete(r.generations).where((0,n.eq)(r.generations.id,e))}};e.s(["storage",0,o]),a()}catch(e){a(e)}},!1),65266,e=>e.a(async(t,a)=>{try{var r=e.i(32085),i=e.i(78844),n=e.i(13456),s=t([r,n]);[r,n]=s.then?(await s)():s;let d=(0,i.default)(async()=>await r.discovery(new URL(process.env.ISSUER_URL??"https://replit.com/oidc"),process.env.REPL_ID),{maxAge:36e5});async function o(e){await n.storage.upsertUser({id:e.sub,email:e.email,firstName:e.first_name,lastName:e.last_name,profileImageUrl:e.profile_image_url})}function l(e){let t=e.headers.host||"localhost:5000";return`https://${t}/api/callback`}function c(e){let t=e.headers.host||"localhost:5000";return`https://${t}`}e.s(["getBaseUrl",()=>c,"getCallbackUrl",()=>l,"getOidcConfig",0,d,"upsertUser",()=>o]),a()}catch(e){a(e)}},!1),51804,e=>e.a(async(t,a)=>{try{var r=e.i(32085),i=e.i(65266),n=t([r,i]);async function s(e,t){try{let a=await (0,i.getOidcConfig)(),n=(0,i.getCallbackUrl)(e),s=r.buildAuthorizationUrl(a,{redirect_uri:n,scope:"openid email profile offline_access",prompt:"login consent"});t.redirect(s.href)}catch(e){console.error("Login error:",e),t.redirect("/?error=login_failed")}}[r,i]=n.then?(await n)():n,e.s(["default",()=>s]),a()}catch(e){a(e)}},!1),10935,e=>e.a(async(t,a)=>{try{var r=e.i(26747),i=e.i(90406),n=e.i(44898),s=e.i(62950),o=e.i(51804),l=e.i(7031),c=e.i(81927),d=e.i(46432),u=t([o]);[o]=u.then?(await u)():u;let h=(0,s.hoist)(o,"default"),m=(0,s.hoist)(o,"config"),g=new n.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/login",pathname:"/api/login",bundlePath:"",filename:""},userland:o,distDir:".next",relativeProjectDir:""});async function p(e,t,a){g.isDev&&(0,d.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/login";i=i.replace(/\/index$/,"")||"/";let n=await g.prepare(e,t,{srcPage:i});if(!n){t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve());return}let{query:s,params:o,prerenderManifest:u,routerServerContext:p}=n;try{let a=e.method||"GET",r=(0,l.getTracer)(),n=r.getActiveScopeSpan(),d=g.instrumentationOnRequestError.bind(g),h=async n=>g.render(e,t,{query:{...s,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:u.preview,propagateError:!1,dev:g.isDev,page:"/api/login",internalRevalidate:null==p?void 0:p.revalidate,onError:(...t)=>d(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=e.get("next.route");if(s){let e=`${a} ${s}`;n.setAttributes({"next.route":s,"http.route":s,"next.span_name":e}),n.updateName(e)}else n.updateName(`${a} ${i}`)});n?await h(n):await r.withPropagatedContext(e.headers,()=>r.trace(c.BaseServerSpan.handleRequest,{spanName:`${a} ${i}`,kind:l.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},h))}catch(e){if(g.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==a.waitUntil||a.waitUntil.call(a,Promise.resolve())}}e.s(["config",0,m,"default",0,h,"handler",()=>p]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__91c7de0e._.js.map